# 12. XMLHttpRequest

XMLHttpRequest ê°ì²´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë²„ì™€ ìƒí˜¸ì‘ìš©ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. XMLHttpRequest ë¥¼ ì‚¬ìš©í•˜ë©´ í˜ì´ì§€ì˜ ìƒˆë¡œê³ ì¹¨ ì—†ì´ data ë¥¼ ë°›ì•„ì˜¤ê³  ì—…ë°ì´íŠ¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

JSON, XML, HTML ê·¸ë¦¬ê³  ì¼ë°˜ í…ìŠ¤íŠ¸ í˜•ì‹ ë“±ì„ í¬í•¨í•œ ë‹¤ì–‘í•œ í¬ë§·ì„ ì£¼ê³  ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤

### Json server

[json-server](https://github.com/typicode/json-server)

```text
npm i -g json-server
```

**DB.json**

```text
{
  "posts": [
    {
      "page": "1",
      "id": 1
    },
    {
      "page": "1",
      "id": 2
    },
  ],
  "comments": [
    {
      "id": 1,
      "body": "some comment",
      "postId": 1
    }
  ],
  "profile": {
    "name": "typicode"
  }
}
```

**onreadystatechange**

íŠ¹ì •ìƒíƒœì— ë”°ë¥¸ í–‰ë™ì„ ì •ì˜í•©ë‹ˆë‹¤. ì„œë²„ ì‘ë‹µì— ë”°ë¥¸ ë¡œì§ì„ ì‘ì„±í•©ë‹ˆë‹¤.

```javascript
httpRequest.onreadystatechange = function(){};
```

**open, send**

openê³¼ send ë¥¼ ì´ìš©í•˜ì—¬ ì„œë²„ë¡œ ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```javascript
httpRequest.open(method, URL, true); // true ëŠ” ë¹„ë™ê¸° ì—¬ë¶€ì…ë‹ˆë‹¤.
httpRequest.send(null);
```

POST ìš”ì²­ì‹œ ë°ì´í„°ë¥¼ ë‹´ì•„ì•¼í•  ë•Œ send ì— ë°ì´í„°ë¥¼ ë‹´ì•„ì„œ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**setRequestHeader**

```javascript
httpRequest.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
```

**readyState, status**

readyState ì‘ë‹µì˜ ìƒíƒœ, status ëŠ” http ì˜ ì‘ë‹µ ìƒíƒœ ì½”ë“œì…ë‹ˆë‹¤.

```javascript
if (httpRequest.readyState === XMLHttpRequest.DONE) {
    // ì´ìƒ ì—†ìŒ, ì‘ë‹µ ë°›ì•˜ìŒ
} else {
    // ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•ŠìŒ
}
```

* 0 \(uninitialized\) - \(requestê°€ ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŒ\)
* 1 \(loading\) - \(ì„œë²„ì™€ì˜ ì—°ê²°ì´ ì„±ì‚¬ë¨\)
* 2 \(loaded\) - \(ì„œë²„ê°€ requestë¥¼ ë°›ìŒ\)
* 3 \(interactive\) - \(request\(ìš”ì²­\)ì„ ì²˜ë¦¬í•˜ëŠ” ì¤‘\)
* 4 \(complete\) - \(requestì— ëŒ€í•œ ì²˜ë¦¬ê°€ ëë‚¬ìœ¼ë©° ì‘ë‹µí•  ì¤€ë¹„ê°€ ì™„ë£Œë¨\)

```javascript
if (httpRequest.status === 200) {
    // ì´ìƒ ì—†ìŒ!
} else {
    // ìš”êµ¬ë¥¼ ì²˜ë¦¬í•˜ëŠ” ê³¼ì •ì—ì„œ ë¬¸ì œê°€ ë°œìƒë˜ì—ˆìŒ
    // ì˜ˆë¥¼ ë“¤ì–´ ì‘ë‹µ ìƒíƒœ ì½”ë“œëŠ” 404 (Not Found) ì´ê±°ë‚˜
    // í˜¹ì€ 500 (Internal Server Error) ì´ ë  ìˆ˜ ìˆìŒ
}
```

### ì˜ˆì œ

```javascript
var httpRequest = new XMLHttpRequest()

httpRequest.open('GET', 'http://localhost:3000/posts', true)
httpRequest.send()

httpRequest.onreadystatechange = function() {
  if (httpRequest.readyState === XMLHttpRequest.DONE) {
    if (httpRequest.status === 200) {
      console.log(JSON.parse(httpRequest.responseText))
    } else {
      alert('ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
    }
  }
}
```

### ë¹„ë™ê¸° ì‘ì—…ì„ ë™ê¸°ì²˜ëŸ¼ ë™ì‘í•˜ê²Œ ë§Œë“œëŠ” ë°©ë²• <a id="ba72"></a>

### Callbackê³¼ Promise, Async/Awaitì˜ ì°¨ì´ì  <a id="ba72"></a>

ë¹„ë™ê¸° ì‘ì—…ì´ë€ ì–¸ì œ ëë‚ ì§€ ëª¨ë¥´ëŠ” ì‘ì—…ì„ ì˜ë¯¸í•œë‹¤.  
í•˜ì§€ë§Œ ìš°ë¦¬ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•  ë•Œ ë¹„ë™ê¸°ë¥¼ ë™ê¸°ì²˜ëŸ¼ ë³´ì¥ë°›ì•„ì•¼í•˜ëŠ” ê²½ìš°ê°€ ìƒê¸°ëŠ”ë°, ì´ë•Œ Callback, Promise, Async/Await ì˜ í˜ì„ ë¹Œë¦¬ê²Œëœë‹¤.![Image for post](https://miro.medium.com/max/60/1*SL_Kyf1N__ohqJCH47LiIw.png?q=20)![Image for post](https://miro.medium.com/max/3192/1*SL_Kyf1N__ohqJCH47LiIw.png)ìˆœì„œë¥¼ ë³´ì¥ ë°›ì§€ ëª»í•œë‹¤

**1. Callback**  
ë¨¼ì € Callback ì„ ì´ìš©í•˜ì—¬ ì´ ë¬¸ì œë¥¼ í•´ê²°í•´ë³´ì.  
ê°ê°ì˜ fetcher ì—ì„œ ë‹¤ìŒ ì‘ì—…ì„ í˜¸ì¶œí•˜ê²Œ ë˜ëŠ”ë°, ì´ë ‡ê²Œ í•˜ë©´ ìš°ë¦¬ê°€ ìˆœì°¨ ë³´ì¥ì´ ê°€ëŠ¥í•˜ë‹¤.  
ï¸ğŸ‘®ğŸ»â€â™€ ï¸í•˜ì§€ë§Œ ìŠ¤ì¼€ì¥´ ê´€ë¦¬í•´ì•¼ë  í•¨ìˆ˜ê°€ ë§ì•„ì§„ë‹¤ë©´ ê°€ë…ì„±ì´ í˜„ì €í•˜ê²Œ ë–¨ì–´ì§€ê²Œë˜ê³ , callback ì• ë’¤ë¡œ ë‹¤ë¥¸ ì½”ë“œê°€ ë“¤ì–´ê°€ë©´ì„œ ì‘ì—…ì˜ ë¶„ë¦¬ê°€ ê¹”ë”í•˜ê²Œ ë˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ìˆë‹¤.



![Image for post](https://miro.medium.com/max/2824/1*3lX0Dpol0v9aLYNI7IDUtw.png)

**2. Promise**  
Callback ì˜ ë‹¨ì ì„ ë³´ì™„í•œê²Œ Promise ì´ë‹¤. PromiseëŠ” then ì´ë¼ëŠ” í•¨ìˆ˜ë¥¼ ì´ìš©í•´ ì‘ì—… ë‹¨ìœ„ë¡œ í•¨ìˆ˜ë¥¼ ìª¼ê°œê³ , Resolveì™€ Reject Callback ì„ ì´ìš©í•´ ìƒí™©ì— ë§ê²Œ ê°’ì„ ì „ë‹¬í•œë‹¤.

![Image for post](https://miro.medium.com/max/2572/1*0cOjERNPaWGJXcm3IHCJMg.png)

ğŸ‘®ğŸ»â€â™€ï¸ ê°€ë…ì„± ì¸¡ë©´ì—ì„œëŠ” Callback ë³´ë‹¤ ì¢‹ì•„ì¡Œì§€ë§Œ, Promise ì¸í„°í˜ì´ìŠ¤ì— ì˜ì¡´í•´ì•¼ëœë‹¤ëŠ” ë¬¸ì œê°€ ìˆë‹¤. ì˜ˆë¥¼ë“¤ë©´ then ì•ˆì— ì½”ë“œê°€ ë¬¶ì¸ë‹¤ê±°ë‚˜ error ì²˜ë¦¬ë¥¼ ìœ„í•´ try/catch ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° Promise ì˜ then/catch ì•ˆì—ì„œ í•˜ëŠ” ì—ëŸ¬ì™€ ì¤‘ë³µìœ¼ë¡œ ì²˜ë¦¬ë¥¼ í•´ì•¼ë˜ëŠ” ë¬¸ì œê°€ ìˆë‹¤.

**3. Async/Await**

Promise ì˜ ë‹¨ì ì„ ë³´ì™„í•œ ê²ƒì´ Async/Await ì´ë‹¤.  
Async Function ì„ ë§Œë“¤ê³  ë‚´ë¶€ì—ì„œ Await ì„ ì´ìš©í•˜ì—¬ ìŠ¤ì¼€ì¥´ ìˆœì„œë¥¼ ì •í•˜ê²Œëœë‹¤. ê°€ë…ì„±ì´ ì¢‹ê³ , ì¸í„°í˜ì´ìŠ¤ì— ë¬¶ì´ì§€ ì•Šê¸° ë•Œë¬¸ì— ì½”ë“œ ë¶„ë¦¬ê°€ ì†ì‰½ê³ ëª¨ë“ˆí™”í•˜ê¸°ë„ ì¢‹ë‹¤.

![Image for post](https://miro.medium.com/max/2860/1*RF5SLq44iTmbEVQQuMocew.png)





